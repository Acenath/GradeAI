{% extends "teacher_course_base.html" %}

{% block title %}Assignment Creation - Gradia{% endblock %}

{% block page_title %}Assignment Creation{% endblock %}

{% block content %}
<h3 class="text-center fw-bold mb-4">{{course_name}}/ Assignment - 1</h3>

<!-- Assignment Form -->
<form method="POST" action="{{ url_for('assignment_creation', course_name = course_name, course_code = course_code) }}" enctype="multipart/form-data">
  
  <!-- Title -->
  <div class="section-box">
    <div class="section-title">Title</div>
    <input type="text" name="title" placeholder="Enter assignment title..." class="form-control" required />
  </div>
  
  <!-- Description -->
  <div class="section-box">
    <div class="section-title">Description</div>
    <textarea name="description" rows="4" placeholder="Enter assignment description..." required></textarea>
  </div>

  <!-- Attachments -->
  <div class="section-box">
    <div class="section-title">Attachments</div>
    
    <div class="text-center" id="upload-area" style="cursor: pointer; padding: 20px; border: 2px dashed #ccc; border-radius: 10px; background-color: #f9f9f9;">
      <i class="fas fa-upload fa-2x mb-2"></i>
      <div>Drag and drop files here or click to upload</div>
    </div>
  
    <!-- Hidden real file input -->
    <input type="file" id="attachmentInput" name="attachments" multiple style="display: none;" />
  
    <!-- Uploaded file list -->
    <div id="fileList" class="mt-3"></div>
  </div>

  <script>
    const uploadArea = document.getElementById('upload-area');
    const attachmentInput = document.getElementById('attachmentInput');
    const fileList = document.getElementById('fileList');
  
    let allFiles = []; // Hold all selected files here
  
    function displayFiles(files) {
      fileList.innerHTML = ""; // Clear previous display
  
      const ul = document.createElement('ul');
      ul.style.listStyle = 'none';
      ul.style.padding = '0';
  
      files.forEach(file => {
        const li = document.createElement('li');
        li.style.display = 'flex';
        li.style.alignItems = 'center';
        li.style.marginBottom = '10px';
  
        li.innerHTML = `
          <i class="fas fa-file-alt me-2" style="color: #555;"></i>
          <span>${file.name}</span>
        `;
  
        ul.appendChild(li);
      });
  
      fileList.appendChild(ul);
    }
  
    uploadArea.addEventListener('click', () => {
      attachmentInput.click(); // Open hidden file input
    });
  
    attachmentInput.addEventListener('change', () => {
      // Add new files to the array
      allFiles = [...allFiles, ...Array.from(attachmentInput.files)];
      displayFiles(allFiles);
    });
  
    // Optional: Drag-and-drop support
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.style.backgroundColor = "#eef"; // highlight
    });
  
    uploadArea.addEventListener('dragleave', (e) => {
      e.preventDefault();
      uploadArea.style.backgroundColor = "#f9f9f9"; // reset
    });
  
    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.style.backgroundColor = "#f9f9f9"; // reset
  
      const droppedFiles = Array.from(e.dataTransfer.files);
      allFiles = [...allFiles, ...droppedFiles];
      displayFiles(allFiles);
    });
  </script>

  <!-- Rubrics -->
  <div class="section-box">
    <div class="section-title">Rubrics</div>
  
    <!-- Rubric entries will be added here -->
    <div id="rubric-container">
      <div class="rubric-entry">
        <textarea name="rubric_descriptions[]" rows="2" placeholder="Rubric description..." required></textarea>
        <input type="number" name="rubric_values[]" placeholder="Value" min="0" required />
      </div>
    </div>
  
    <!-- Add Rubric Button -->
    <div style="margin-top: 10px;">
      <button type="button" id="add-rubric-btn" class="btn btn-secondary">Add Rubric</button>
    </div>
  </div>
  
  <script>
    const rubricContainer = document.getElementById('rubric-container');
    const addRubricBtn = document.getElementById('add-rubric-btn');
  
    addRubricBtn.addEventListener('click', () => {
      const newRubric = document.createElement('div');
      newRubric.classList.add('rubric-entry');
      newRubric.innerHTML = `
        <textarea name="rubric_descriptions[]" rows="2" placeholder="Rubric description..." required></textarea>
        <input type="number" name="rubric_values[]" placeholder="Value" required />
      `;
      rubricContainer.appendChild(newRubric);
    });
  </script>
  
  <!-- Footer Fields -->
  <div class="section-box">
    <div class="footer-fields">
        <input type="date" name="Date" placeholder="Due Date" required />
        <select name="file_type" required>
            <option value="Any">Any</option>
            <option value="PDF">PDF</option>
            <option value="DOCX">DOCX</option>
        </select>
        <input type="number" name="max_file_no" placeholder="Max File No" min="1" required />
    </div>
  </div>

  <!-- Create Button -->
  <button class="create-btn" type="submit">Create</button>
</form>
{% endblock %}
